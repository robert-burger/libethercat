<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libethercat - an embeddable realtime EtherCAT-master library: include/libethercat/dc.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libethercat - an embeddable realtime EtherCAT-master library
   </div>
   <div id="projectbrief">Communicate with EtherCAT slaves attached to a Network interface.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('dc_8h.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">dc.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>ethercat distributed clocks support.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;libosal/types.h&gt;</code><br />
<code>#include &lt;libosal/mutex.h&gt;</code><br />
<code>#include &quot;<a class="el" href="common_8h_source.html">libethercat/common.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="idx_8h_source.html">libethercat/idx.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="pool_8h_source.html">libethercat/pool.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="datagram_8h_source.html">libethercat/datagram.h</a>&quot;</code><br />
</div>
<p><a href="dc_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structec__dc__info__slave.html">ec_dc_info_slave</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structec__dc__info.html">ec_dc_info</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a8289048b3b0bbbe865c97bae16c9afcc"><td class="memItemLeft" align="right" valign="top"><a id="a8289048b3b0bbbe865c97bae16c9afcc"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>EC_REG_DCSYNCACT__SYNC_OUT_UNIT_ACTIVATION</b>&#160;&#160;&#160;( 0x01u )</td></tr>
<tr class="separator:a8289048b3b0bbbe865c97bae16c9afcc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa8b90fa7775d96c00508190fd0fe35a5"><td class="memItemLeft" align="right" valign="top"><a id="aa8b90fa7775d96c00508190fd0fe35a5"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>EC_REG_DCSYNCACT__SYNC_OUT_UNIT_SYNC0</b>&#160;&#160;&#160;( 0x02u )</td></tr>
<tr class="separator:aa8b90fa7775d96c00508190fd0fe35a5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a703d1712b4bcdf009c34bf2678360e5b"><td class="memItemLeft" align="right" valign="top"><a id="a703d1712b4bcdf009c34bf2678360e5b"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>EC_REG_DCSYNCACT__SYNC_OUT_UNIT_SYNC1</b>&#160;&#160;&#160;( 0x04u )</td></tr>
<tr class="separator:a703d1712b4bcdf009c34bf2678360e5b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a850edf1710f136815258963b62b4768b"><td class="memItemLeft" align="right" valign="top"><a id="a850edf1710f136815258963b62b4768b"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>EC_REG_DCSYNCACT__SYNC_OUT_UNIT_AUTO_ACTIVATION</b>&#160;&#160;&#160;( 0x08u )</td></tr>
<tr class="separator:a850edf1710f136815258963b62b4768b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a605a9365f6346486d09d924bf1c84e2e"><td class="memItemLeft" align="right" valign="top"><a id="a605a9365f6346486d09d924bf1c84e2e"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>EC_REG_DCSYNCACT__SYNC_OUT_UNIT_EXT_64BIT</b>&#160;&#160;&#160;( 0x10u )</td></tr>
<tr class="separator:a605a9365f6346486d09d924bf1c84e2e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aab4fcec46a9aee617b2b1a97e4c3c71f"><td class="memItemLeft" align="right" valign="top"><a id="aab4fcec46a9aee617b2b1a97e4c3c71f"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>EC_REG_DCSYNCACT__SYNC_OUT_UNIT_START_TIME_CHECK</b>&#160;&#160;&#160;( 0x20u )</td></tr>
<tr class="separator:aab4fcec46a9aee617b2b1a97e4c3c71f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2c5ae068a63dbb226919ab9ab2268b54"><td class="memItemLeft" align="right" valign="top"><a id="a2c5ae068a63dbb226919ab9ab2268b54"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>EC_REG_DCSYNCACT__SYNC_OUT_UNIT_NEAR_FUTURE_CONFIG</b>&#160;&#160;&#160;( 0x40u )</td></tr>
<tr class="separator:a2c5ae068a63dbb226919ab9ab2268b54"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a96405c99ecfa798279e8a5560c5ebc03"><td class="memItemLeft" align="right" valign="top"><a id="a96405c99ecfa798279e8a5560c5ebc03"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>EC_REG_DCSYNCACT__SYNC_OUT_UNIT_DEBUG_PULSE</b>&#160;&#160;&#160;( 0x80u )</td></tr>
<tr class="separator:a96405c99ecfa798279e8a5560c5ebc03"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ce965a8a38d098c07bc82a9d255a184"><td class="memItemLeft" align="right" valign="top"><a id="a4ce965a8a38d098c07bc82a9d255a184"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>EC_DC_ACTIVATION_REG_SYNC0</b>&#160;&#160;&#160;( 0x3 )</td></tr>
<tr class="separator:a4ce965a8a38d098c07bc82a9d255a184"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a50097d6e932ba4dbb9866b05a77f7b06"><td class="memItemLeft" align="right" valign="top"><a id="a50097d6e932ba4dbb9866b05a77f7b06"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>EC_DC_ACTIVATION_REG_SYNC1</b>&#160;&#160;&#160;( 0x5 )</td></tr>
<tr class="separator:a50097d6e932ba4dbb9866b05a77f7b06"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a606de07c307459d5b9fa0e071cabc6a1"><td class="memItemLeft" align="right" valign="top"><a id="a606de07c307459d5b9fa0e071cabc6a1"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>EC_DC_ACTIVATION_REG_SYNC01</b>&#160;&#160;&#160;( 0x7 )</td></tr>
<tr class="separator:a606de07c307459d5b9fa0e071cabc6a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:ab25f777a743b2eba0a3ba5f8098438c7"><td class="memItemLeft" align="right" valign="top"><a id="ab25f777a743b2eba0a3ba5f8098438c7"></a>
typedef struct <a class="el" href="structec__dc__info__slave.html">ec_dc_info_slave</a>&#160;</td><td class="memItemRight" valign="bottom"><b>ec_dc_info_slave_t</b></td></tr>
<tr class="separator:ab25f777a743b2eba0a3ba5f8098438c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abab7a0fa5bc1eae7bad6ebb29ece09d0"><td class="memItemLeft" align="right" valign="top"><a id="abab7a0fa5bc1eae7bad6ebb29ece09d0"></a>
typedef enum ec_dc_mode&#160;</td><td class="memItemRight" valign="bottom"><b>ec_dc_mode_t</b></td></tr>
<tr class="separator:abab7a0fa5bc1eae7bad6ebb29ece09d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afb236276bb53d5095c70ad9a56f575df"><td class="memItemLeft" align="right" valign="top"><a id="afb236276bb53d5095c70ad9a56f575df"></a>
typedef struct <a class="el" href="structec__dc__info.html">ec_dc_info</a>&#160;</td><td class="memItemRight" valign="bottom"><b>ec_dc_info_t</b></td></tr>
<tr class="separator:afb236276bb53d5095c70ad9a56f575df"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:a67342b24b6d2ab640ffab066309008d4"><td class="memItemLeft" align="right" valign="top"><a id="a67342b24b6d2ab640ffab066309008d4"></a>enum &#160;</td><td class="memItemRight" valign="bottom"><b>ec_dc_mode</b> { <b>dc_mode_master_clock</b> = 0
, <b>dc_mode_ref_clock</b>
, <b>dc_mode_master_as_ref_clock</b>
 }</td></tr>
<tr class="separator:a67342b24b6d2ab640ffab066309008d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ad82933407629a3944d0f97dc53772296"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dc_8h.html#ad82933407629a3944d0f97dc53772296">ec_dc_config</a> (struct <a class="el" href="structec.html">ec</a> *pec)</td></tr>
<tr class="memdesc:ad82933407629a3944d0f97dc53772296"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prepare EtherCAT master and slaves for distributed clocks.  <a href="dc_8h.html#ad82933407629a3944d0f97dc53772296">More...</a><br /></td></tr>
<tr class="separator:ad82933407629a3944d0f97dc53772296"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:affef6d3509931c456160ce45876c2a15"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dc_8h.html#affef6d3509931c456160ce45876c2a15">ec_dc_sync</a> (struct <a class="el" href="structec.html">ec</a> *pec, osal_uint16_t slave, osal_uint8_t dc_active, osal_uint32_t cycle_time_0, osal_uint32_t cycle_time_1, osal_int32_t cycle_shift)</td></tr>
<tr class="memdesc:affef6d3509931c456160ce45876c2a15"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configure EtherCAT slave for distributed clock sync0 and sync1 pulse.  <a href="dc_8h.html#affef6d3509931c456160ce45876c2a15">More...</a><br /></td></tr>
<tr class="separator:affef6d3509931c456160ce45876c2a15"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>ethercat distributed clocks support. </p>
<dl class="section author"><dt>Author</dt><dd>Robert Burger &lt;robert.burger\dlr.de&gt;</dd></dl>
<dl class="section date"><dt>Date</dt><dd>11 Nov 2016</dd></dl>
<p>These functions are used to enable distributed clocks support on the EtherCAT master and to configure one ore more EtherCAT slaves to enable the sync0 and/or sync1 pulse generation. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="ad82933407629a3944d0f97dc53772296"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad82933407629a3944d0f97dc53772296">&#9670;&nbsp;</a></span>ec_dc_config()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ec_dc_config </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structec.html">ec</a> *&#160;</td>
          <td class="paramname"><em>pec</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prepare EtherCAT master and slaves for distributed clocks. </p>
<p>Check all slaves if they support distributed clocks and measure delays.</p>
<p>DC support can be determined from EtherCAT slave's feature register (0x08). which is automatically read on EtherCAT master's INIT phase. On all slaves supporting DC's the system time is read and written to the system time offset to set slave time to 0. afterwards the port times are taken and the propagation delays are calculated and written.</p>
<p>This function does not enable distributed clock sync0/1 pulse generation on the slaves. this has to be done with <a class="el" href="">ec_dc_sync0</a> or <a class="el" href="">ec_dc_sync01</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pec</td><td>Pointer to EtherCAT master structure. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>supported dc </dd></dl>

</div>
</div>
<a id="affef6d3509931c456160ce45876c2a15"></a>
<h2 class="memtitle"><span class="permalink"><a href="#affef6d3509931c456160ce45876c2a15">&#9670;&nbsp;</a></span>ec_dc_sync()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ec_dc_sync </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structec.html">ec</a> *&#160;</td>
          <td class="paramname"><em>pec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">osal_uint16_t&#160;</td>
          <td class="paramname"><em>slave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">osal_uint8_t&#160;</td>
          <td class="paramname"><em>dc_active</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">osal_uint32_t&#160;</td>
          <td class="paramname"><em>cycle_time_0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">osal_uint32_t&#160;</td>
          <td class="paramname"><em>cycle_time_1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">osal_int32_t&#160;</td>
          <td class="paramname"><em>cycle_shift</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Configure EtherCAT slave for distributed clock sync0 and sync1 pulse. </p>
<p>This function writes the cycle time, calculates the DC first start time wrt the cycle shift and enables sync0 and sync1 pulse generation on the corresponding device. It can also be use to disable DC's on the EtherCAT slave.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pec</td><td>Pointer to EtherCAT master structure. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">slave</td><td>Slave number. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dc_active</td><td>Dc active flag. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cycle_time_0</td><td>Cycle time to program to fire sync0 in [ns]. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cycle_time_1</td><td>Cycle time to program to fire sync1 in [ns]. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cycle_shift</td><td>Shift of first sync0 start in [ns]. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="dir_6ce0b57c15e65b5e5abf78abc9512688.html">libethercat</a></li><li class="navelem"><a class="el" href="dc_8h.html">dc.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
